Четвертый блок посвящен **методологии проектирования баз данных**. Это критически важный этап, так как ошибки, допущенные при проектировании, крайне сложно и дорого исправлять на этапе работающей системы.

Ниже приведен подробный разбор всех вопросов этого блока.

---

### 1. Общая методология проектирования баз данных

Проектирование БД — это процесс создания схемы базы данных, которая отвечает требованиям пользователей и бизнес-логике. Общепринятая методология основана на **трехуровневой архитектуре** (модели ANSI/SPARC), которая делит процесс на три последовательных этапа:

1.  **Концептуальное (инфологическое) проектирование:** Создание абстрактной модели предметной области, не зависящей от конкретной СУБД.
2.  **Логическое (даталогическое) проектирование:** Описание данных в терминах выбранной модели (например, реляционной — в виде таблиц), но без учета физических особенностей хранения.
3.  **Физическое проектирование:** Определение способов размещения данных на дисках, создание индексов и настройка производительности под конкретную СУБД и аппаратное обеспечение.

**Цели методологии:**
*   Исключение избыточности данных (дублирования).
*   Обеспечение целостности и непротиворечивости.
*   Обеспечение эффективного доступа к данным.

---

### 2. Этап концептуального проектирования баз данных

На этом этапе создается модель «бизнес-мира». Главная задача — формализовать требования заказчика, не задумываясь о том, будет ли это SQL, NoSQL или текстовый файл.

**Основные инструменты:**
*   **ER-модель (Entity-Relationship — Сущность-Связь):** Самый популярный графический способ описания.

**Ключевые понятия:**
*   **Сущность (Entity):** Объект предметной области (например, «Студент», «Книга»).
*   **Атрибут (Attribute):** Свойство сущности (например, «ФИО студента», «Цена книги»).
*   **Связь (Relationship):** Взаимодействие между сущностями (например, студент «сдает» экзамен).

**Типы связей:**
*   **1:1 (один к одному):** Один паспорт принадлежит одному человеку.
*   **1:N (один ко многим):** В одном отделе работают много сотрудников.
*   **M:N (многие ко многим):** Один студент посещает много курсов, один курс посещается многими студентами.

**Результат этапа:** Концептуальная схема (ER-диаграмма), понятная как программисту, так и заказчику.

---

### 3. Этап логического проектирования баз данных

На этом этапе концептуальная модель преобразуется в структуру, которую «понимает» выбранный тип СУБД (чаще всего реляционный).

**Основные задачи:**
1.  **Преобразование сущностей в таблицы:** Каждая сущность становится таблицей.
2.  **Определение атрибутов и типов данных:** Каждое свойство становится столбцом.
3.  **Выбор первичных ключей (Primary Key):** Определение уникального идентификатора для каждой таблицы.
4.  **Установление связей через внешние ключи (Foreign Key):**
    *   Связь 1:N реализуется добавлением ID родителя в таблицу потомка.
    *   Связь M:N реализуется через создание дополнительной «связующей» таблицы.
5.  **Нормализация:** Проверка структуры на соответствие правилам (нормальным формам) для исключения аномалий.

**Результат этапа:** Набор схем таблиц со всеми связями и ограничениями.

---

### 4. Требования нормальных форм (Нормализация)

Нормализация — это процесс организации данных в таблицах с целью минимизации избыточности и устранения аномалий (ошибок при вставке, обновлении или удалении).

*   **1-я нормальная форма (1НФ):**
    *   Требование: Все значения в ячейках должны быть **атомарными** (неделимыми). Нельзя хранить список телефонов в одной ячейке через запятую.
*   **2-я нормальная форма (2НФ):**
    *   Условие: Таблица находится в 1НФ.
    *   Требование: Каждый неключевой атрибут должен **полностью** зависеть от всего первичного ключа. Это актуально для составных ключей (из двух и более полей). Если поле зависит только от части ключа — его надо вынести в отдельную таблицу.
*   **3-я нормальная форма (3НФ):**
    *   Условие: Таблица находится в 2НФ.
    *   Требование: В таблице должны отсутствовать **транзитивные зависимости**. Это значит, что неключевое поле должно зависеть только от ключа, а не от другого неключевого поля. (Например: если в таблице «Сотрудник» есть «ID отдела» и «Название отдела», то название зависит от ID, а не от сотрудника — это нарушение 3НФ).

**Результат:** База данных, в которой каждое значение хранится ровно в одном месте.

---

### 5. Этап физического проектирования баз данных

Это завершающий этап, где логическая схема адаптируется под конкретное «железо» и специфику СУБД (PostgreSQL, Oracle, MySQL и др.).

**Основные задачи:**
1.  **Выбор типов данных:** Определение оптимальных типов (например, `INT` vs `BIGINT`, `VARCHAR` vs `TEXT`) для экономии места.
2.  **Проектирование индексов:** Определение того, по каким полям будет идти поиск, и создание соответствующих B-деревьев или Hash-индексов для ускорения.
3.  **Размещение данных:** Определение того, на каких дисках будут лежать файлы данных, а на каких — логи транзакций.
4.  **Денормализация (опционально):** Сознательное нарушение правил нормализации для повышения скорости чтения (если запросы на объединение таблиц работают слишком медленно).
5.  **Настройка безопасности:** Определение прав доступа к конкретным файлам и таблицам.
6.  **Партиционирование:** Разделение очень больших таблиц на части (по годам или регионам) для удобства обслуживания.

**Результат этапа:** Готовый скрипт на языке SQL (DDL), создающий базу данных, оптимизированную под нагрузку.
